$(function(){var g=$("#item-template").html(),h=Handlebars.compile(g),e=$("#items"),f=$("#refresh-icon"),b={iframeUnfriendlyHosts:"nytimes.com,groups.google.com,plus.google.com,stackexchange.com,flickr.com,market.android.com,twitch.tv,bmj.com".split(","),frameFriendlyHost:function(a){var b=!0;this.iframeUnfriendlyHosts.forEach(function(c){a.match(c)&&(b=!1)});return b},markFrameUnfriendlyLinks:function(){var a,d;$(".item").each(function(c,e){a=$(e);d=a.find("h2 a").attr("href");b.frameFriendlyHost(d)||
a.addClass("frame_unfriendly_host")})},selectedFeed:"top",selectFeed:function(a){this.selectedFeed=a;this.loadItems();$("#itemListToolbar a").removeClass("active");$("#"+a).addClass("active")},iframeLoadComplete:function(){$("#loadingIndicator").hide()},iframeLoadBegin:function(){$("#loadingIndicator").show()},loadItems:function(){this.loadingItems();$.getJSON("/"+b.selectedFeed+".json",function(a){e.html("");a.forEach(function(a){e.append(h(a))});b.itemsLoaded();b.markFrameUnfriendlyLinks()})},loadingItems:function(){f.addClass("disabled")},
itemsLoaded:function(){f.removeClass("disabled")},resizeItemsList:function(){$("#items").css("height",$(window).height()-30)}};b.resizeItemsList();b.loadItems();$(window).resize(function(){b.resizeItemsList()});$("#refresh").click(function(a){a.preventDefault();b.loadItems()});$("#top").click(function(a){a.preventDefault();b.selectFeed("top")});$("#newest").click(function(a){a.preventDefault();b.selectFeed("newest")});$(".item").live("click",function(a){if(!$(a.target).parent().hasClass("go_to_site")){var d=
$(a.currentTarget),c=d.find("h2 a").attr("href");a.preventDefault();b.iframeLoadBegin();$(".selected").removeClass("selected");d.addClass("selected");b.frameFriendlyHost(c)?$("#itemContent").attr("src",c):($("#itemContent").attr("src","/frame_unfriendly_host.html"),setTimeout(function(){window.open(c)},2E3))}});$(".item .comments a").live("click",function(a){a.stopPropagation();var a=$(a.currentTarget),b=a.parents("div.item");$(".selected").removeClass("selected");b.addClass("selected");$("#itemContent").attr("src",
a.attr("href"));return!1});$("#itemContent").load(function(){b.iframeLoadComplete()})});
